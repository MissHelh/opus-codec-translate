<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Opus: Opus Encoder</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
</head>
<body>



<div id="top"><!-- do not remove this div! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 64px;">
  <td style="padding-left: 0.5em;">
  <div id="projectname"><img src="http://www.opus-codec.org/docs/html_api-1.1.0/opus_logo.svg" width=112 height=64 alt="Opus"/><!--Opus--></div>
  </td>
  <td><table style="padding-left: 0.5em;" cellspacing="0" cellpadding="0"><tbody>
   <tr><td>
   <div id="projectbrief">Opus 音频编解码器(RFC 6716): API和操作手册</div>
   </td></tr>
  <td><span id="projectnumber">1.1</span>
   </td></tr>
   </table>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>主&#160;页</span></a></li>
      <li><a href="modules.html"><span>模块</span></a></li>
      <li><a href="files.html"><span>文件</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>全部</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>文件</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>函数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>类型定义</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>宏</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#typedef-members">类型定义</a> &#124;
<a href="#func-members">函数</a>  </div>
  <div class="headertitle">
<div class="title">Opus 编码</div>  </div>
</div><!--header-->
<div class="contents">

<p>该页面描述Opus编码的使用过程与功能。
<a href="#details">更多...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
类型定义</h2></td></tr>
<tr class="memitem:gaf461a3ef2f10c2fe8b994a176f06c9bd"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaf461a3ef2f10c2fe8b994a176f06c9bd">OpusEncoder</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaf461a3ef2f10c2fe8b994a176f06c9bd">OpusEncoder</a></td></tr>
<tr class="memdesc:gaf461a3ef2f10c2fe8b994a176f06c9bd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Opus 编码状态。<a href="#gaf461a3ef2f10c2fe8b994a176f06c9bd">更多...</a><br/></td></tr>
<tr class="separator:gaf461a3ef2f10c2fe8b994a176f06c9bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gaefeb7dc1d6e3b59dea5ea674c86e9c18"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaefeb7dc1d6e3b59dea5ea674c86e9c18">opus_encoder_get_size</a> (int channels)</td></tr>
<tr class="memdesc:gaefeb7dc1d6e3b59dea5ea674c86e9c18"><td class="mdescLeft">&#160;</td><td class="mdescRight">得到一个 <code>OpusEncoder</code> 结构体的大小。  <a href="#gaefeb7dc1d6e3b59dea5ea674c86e9c18">更多...</a><br/></td></tr>
<tr class="separator:gaefeb7dc1d6e3b59dea5ea674c86e9c18"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa89264fd93c9da70362a0c9b96b9ca88"><td class="memItemLeft" align="right" valign="top"><a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaf461a3ef2f10c2fe8b994a176f06c9bd">OpusEncoder</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaa89264fd93c9da70362a0c9b96b9ca88">opus_encoder_create</a> (<a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/opus__types_8h.html#aa4d309d6f80b99dbabebc8f98879ab9a">opus_int32</a> Fs, int channels, int application, int *error)</td></tr>
<tr class="memdesc:gaa89264fd93c9da70362a0c9b96b9ca88"><td class="mdescLeft">&#160;</td><td class="mdescRight">分配并初始化编码状态。<a href="#gaa89264fd93c9da70362a0c9b96b9ca88">更多...</a><br/></td></tr>
<tr class="separator:gaa89264fd93c9da70362a0c9b96b9ca88"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga515db1c267a7421dacaad3610f79eb79"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#ga515db1c267a7421dacaad3610f79eb79">opus_encoder_init</a> (<a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaf461a3ef2f10c2fe8b994a176f06c9bd">OpusEncoder</a> *st, <a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/opus__types_8h.html#aa4d309d6f80b99dbabebc8f98879ab9a">opus_int32</a> Fs, int channels, int application)</td></tr>
<tr class="memdesc:ga515db1c267a7421dacaad3610f79eb79"><td class="mdescLeft">&#160;</td><td class="mdescRight">初始化一个预分配的编码状态，该内存由 st 指向一块大小最小为 <a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaefeb7dc1d6e3b59dea5ea674c86e9c18" title="Gets the size of an OpusEncoder structure.">opus_encoder_get_size()</a> 返回值的内存空间。<a href="#ga515db1c267a7421dacaad3610f79eb79">更多...</a><br/></td></tr>
<tr class="separator:ga515db1c267a7421dacaad3610f79eb79"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad2d6bf6a9ffb6674879d7605ed073e25"><td class="memItemLeft" align="right" valign="top"><a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/opus__types_8h.html#aa4d309d6f80b99dbabebc8f98879ab9a">opus_int32</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gad2d6bf6a9ffb6674879d7605ed073e25">opus_encode</a> (<a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaf461a3ef2f10c2fe8b994a176f06c9bd">OpusEncoder</a> *st, const <a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/opus__types_8h.html#acc9ed7cf60479eb81f9648c6ec27dc26">opus_int16</a> *pcm, int frame_size, unsigned char *data, <a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/opus__types_8h.html#aa4d309d6f80b99dbabebc8f98879ab9a">opus_int32</a> max_data_bytes)</td></tr>
<tr class="memdesc:gad2d6bf6a9ffb6674879d7605ed073e25"><td class="mdescLeft">&#160;</td><td class="mdescRight">编码 Opus 帧。  <a href="#gad2d6bf6a9ffb6674879d7605ed073e25">更多...</a><br/></td></tr>
<tr class="separator:gad2d6bf6a9ffb6674879d7605ed073e25"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4ae9905859cd241ef4bb5c59cd5e5309"><td class="memItemLeft" align="right" valign="top"><a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/opus__types_8h.html#aa4d309d6f80b99dbabebc8f98879ab9a">opus_int32</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#ga4ae9905859cd241ef4bb5c59cd5e5309">opus_encode_float</a> (<a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaf461a3ef2f10c2fe8b994a176f06c9bd">OpusEncoder</a> *st, const float *pcm, int frame_size, unsigned char *data, <a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/opus__types_8h.html#aa4d309d6f80b99dbabebc8f98879ab9a">opus_int32</a> max_data_bytes)</td></tr>
<tr class="memdesc:ga4ae9905859cd241ef4bb5c59cd5e5309"><td class="mdescLeft">&#160;</td><td class="mdescRight">通过浮点输入编码 Opus 帧。  <a href="#ga4ae9905859cd241ef4bb5c59cd5e5309">更多...</a><br/></td></tr>
<tr class="separator:ga4ae9905859cd241ef4bb5c59cd5e5309"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5f4c05b4b51cdffec5a55dbf17bbfa1c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#ga5f4c05b4b51cdffec5a55dbf17bbfa1c">opus_encoder_destroy</a> (<a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaf461a3ef2f10c2fe8b994a176f06c9bd">OpusEncoder</a> *st)</td></tr>
<tr class="memdesc:ga5f4c05b4b51cdffec5a55dbf17bbfa1c"><td class="mdescLeft">&#160;</td><td class="mdescRight">释放由 <a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaa89264fd93c9da70362a0c9b96b9ca88" title="Allocates and initializes an encoder state.">opus_encoder_create()</a> 分配的 <code>OpusEncoder</code>。<a href="#ga5f4c05b4b51cdffec5a55dbf17bbfa1c">更多...</a><br/></td></tr>
<tr class="separator:ga5f4c05b4b51cdffec5a55dbf17bbfa1c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga164cbb0425238961919adf1db67949df"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#ga164cbb0425238961919adf1db67949df">opus_encoder_ctl</a> (<a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaf461a3ef2f10c2fe8b994a176f06c9bd">OpusEncoder</a> *st, int request,...)</td></tr>
<tr class="memdesc:ga164cbb0425238961919adf1db67949df"><td class="mdescLeft">&#160;</td><td class="mdescRight">使用 CTL 执行 Opus 编码 <a href="#ga164cbb0425238961919adf1db67949df">更多...</a><br/></td></tr>
<tr class="separator:ga164cbb0425238961919adf1db67949df"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">详细描述</h2>
<p>该页面描述Opus编码的使用过程与功能。 </p>
<p>因为Opus是基于状态的编解码器，其编码从创建一个编码状态开始执行，具体如下：</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span>          error;</div>
<div class="line"><a class="code" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaf461a3ef2f10c2fe8b994a176f06c9bd" title="Opus encoder state.">OpusEncoder</a> *enc;</div>
<div class="line">enc = <a class="code" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaa89264fd93c9da70362a0c9b96b9ca88" title="Allocates and initializes an encoder state.">opus_encoder_create</a>(Fs, channels, application, &amp;error);</div>
</div><!-- fragment --><p>从这里开始，<code>enc</code>可以被用来编码音频数据流。一个编码状态在同一时刻<b>仅可</b>编码<b>一个</b>数据流。同样的，编码状态<b>不可以</b>被多个编码帧初始化。</p>
<p>当使用 <a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaa89264fd93c9da70362a0c9b96b9ca88" title="Allocates and initializes an encoder state.">opus_encoder_create()</a> 函数为编码状态分配内存时，它很可能是初始化了一块预分配的内存:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span>          size;</div>
<div class="line"><span class="keywordtype">int</span>          error;</div>
<div class="line"><a class="code" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaf461a3ef2f10c2fe8b994a176f06c9bd" title="Opus encoder state.">OpusEncoder</a> *enc;</div>
<div class="line">size = <a class="code" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaefeb7dc1d6e3b59dea5ea674c86e9c18" title="Gets the size of an OpusEncoder structure.">opus_encoder_get_size</a>(channels);</div>
<div class="line">enc = malloc(size);</div>
<div class="line">error = <a class="code" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#ga515db1c267a7421dacaad3610f79eb79" title="Initializes a previously allocated encoder state The memory pointed to by st must be at least the siz...">opus_encoder_init</a>(enc, Fs, channels, application);</div>
</div><!-- fragment --><p>函数 <a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaefeb7dc1d6e3b59dea5ea674c86e9c18" title="Gets the size of an OpusEncoder structure.">opus_encoder_get_size()</a> 返回编码状态所需的内存大小。(Note that future versions of this code may change the size, so no assuptions should be made about it)</p>
<p>编码状态总是使用一段连续的内存空间，仅使用浅拷贝就足够拷贝 (e.g. memcpy())</p>
<p>经常有可能需要修改使用 <a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#ga164cbb0425238961919adf1db67949df" title="Perform a CTL function on an Opus encoder.">opus_encoder_ctl()</a> 接口的编码设置。所有这些设置已经使用了推荐的默认值，仅在必要时修改。最常需要修改的设置有：</p>
<div class="fragment"><div class="line"><a class="code" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#ga164cbb0425238961919adf1db67949df" title="Perform a CTL function on an Opus encoder.">opus_encoder_ctl</a>(enc, <a class="code" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoderctls.html#ga0bb51947e355b33d0cb358463b5101a7" title="Configures the bitrate in the encoder.">OPUS_SET_BITRATE</a>(bitrate));</div>
<div class="line"><a class="code" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#ga164cbb0425238961919adf1db67949df" title="Perform a CTL function on an Opus encoder.">opus_encoder_ctl</a>(enc, <a class="code" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoderctls.html#ga3483877bf1687a75dd4a1de6f85f291c" title="Configures the encoder&#39;s computational complexity.">OPUS_SET_COMPLEXITY</a>(complexity));</div>
<div class="line"><a class="code" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#ga164cbb0425238961919adf1db67949df" title="Perform a CTL function on an Opus encoder.">opus_encoder_ctl</a>(enc, <a class="code" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoderctls.html#gaaa87ccee4ae46aa6c9528e03c5122b89" title="Configures the type of signal being encoded.">OPUS_SET_SIGNAL</a>(signal_type));</div>
</div><!-- fragment --><p>参数</p>
<ul>
<li>bitrate 每秒比特数(b/s)</li>
<li>complexity 是一个从1到10的整数，1表示复杂度最低，10表示最高</li>
<li>signal_type 可使用值有：OPUS_AUTO (默认), OPUS_SIGNAL_VOICE, or OPUS_SIGNAL_MUSIC</li>
</ul>
<p>查看 <a class="el" href="group__opus__encoderctls.html">Encoder related CTLs</a> 与 <a class="el" href="group__opus__genericctls.html">通用 CTLs</a> 栏目有完整的可设置参数列表，绝大多数参数可以在数据流编解码码过程中进行设置或修改。</p>
<p>为编码一个音频帧 <a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gad2d6bf6a9ffb6674879d7605ed073e25" title="Encodes an Opus frame.">opus_encode()</a> or <a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#ga4ae9905859cd241ef4bb5c59cd5e5309" title="Encodes an Opus frame from floating point input.">opus_encode_float()</a> 函数必须在音频数据的一帧中调用(2.5, 5, 10, 20, 40 or 60 ms): </p>
<div class="fragment"><div class="line">len = <a class="code" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gad2d6bf6a9ffb6674879d7605ed073e25" title="Encodes an Opus frame.">opus_encode</a>(enc, audio_frame, frame_size, packet, max_packet);</div>
</div><!-- fragment --><p>参数 </p>
<ul>
<li>
audio_frame 音频数据 in opus_int16 (or float for <a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#ga4ae9905859cd241ef4bb5c59cd5e5309" title="Encodes an Opus frame from floating point input.">opus_encode_float()</a>) </li>
<li>
frame_size 每一帧的持续时间(每个通道) </li>
<li>
packet 写入压缩数据的比特数组</li>
<li>
max_packet 数据包可容纳最大比特大小(推荐使用4000比特)。不要使用max_packet来控制VBR目标比特率，而是使用 <a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoderctls.html#ga0bb51947e355b33d0cb358463b5101a7" title="Configures the bitrate in the encoder.">OPUS_SET_BITRATE</a> CTL. </li>
</ul>
<p><a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gad2d6bf6a9ffb6674879d7605ed073e25" title="Encodes an Opus frame.">opus_encode()</a> 和 <a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#ga4ae9905859cd241ef4bb5c59cd5e5309" title="Encodes an Opus frame from floating point input.">opus_encode_float()</a> 返回数据包中实际写入的比特数，返回值<b>可以为负数</b>，表明发生错误。如果返回值为1 byte，表示该数据包不需要传输(DTX).</p>
<p>当编码状态不在需要时，可以被销毁掉</p>
<div class="fragment"><div class="line"><a class="code" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#ga5f4c05b4b51cdffec5a55dbf17bbfa1c" title="Frees an OpusEncoder allocated by opus_encoder_create().">opus_encoder_destroy</a>(enc);</div>
</div><!-- fragment --><p>如果编码其是由 <a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#ga515db1c267a7421dacaad3610f79eb79" title="Initializes a previously allocated encoder state The memory pointed to by st must be at least the siz...">opus_encoder_init()</a> 创建，而不是 <a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaa89264fd93c9da70362a0c9b96b9ca88" title="Allocates and initializes an encoder state.">opus_encoder_create()</a>，那么无需其他操作，除非释放手动分配的内存(如在上述例子中调用 free(enc)) </p>
<h2 class="groupheader">类型定义 文档</h2>
<a class="anchor" id="gaf461a3ef2f10c2fe8b994a176f06c9bd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaf461a3ef2f10c2fe8b994a176f06c9bd">OpusEncoder</a> <a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaf461a3ef2f10c2fe8b994a176f06c9bd">OpusEncoder</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Opus 编码状态。</p>
<p>包含Opus编码器的完整状态。该值独立且可以自由复制。</p>
<dl class="section see"><dt>另请参见：</dt><dd><a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaa89264fd93c9da70362a0c9b96b9ca88" title="Allocates and initializes an encoder state.">opus_encoder_create</a>,<a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#ga515db1c267a7421dacaad3610f79eb79" title="Initializes a previously allocated encoder state The memory pointed to by st must be at least the siz...">opus_encoder_init</a> </dd></dl>

</div>
</div>
<h2 class="groupheader">函数 文档</h2>
<a class="anchor" id="gad2d6bf6a9ffb6674879d7605ed073e25"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/opus__types_8h.html#aa4d309d6f80b99dbabebc8f98879ab9a">opus_int32</a> opus_encode </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaf461a3ef2f10c2fe8b994a176f06c9bd">OpusEncoder</a> *&#160;</td>
          <td class="paramname"><em>st</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/opus__types_8h.html#acc9ed7cf60479eb81f9648c6ec27dc26">opus_int16</a> *&#160;</td>
          <td class="paramname"><em>pcm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>frame_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/opus__types_8h.html#aa4d309d6f80b99dbabebc8f98879ab9a">opus_int32</a>&#160;</td>
          <td class="paramname"><em>max_data_bytes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>编码Opus帧。</p>
<dl class="params"><dt>参数：</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">st</td><td><code>OpusEncoder*</code>: 编码状态 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pcm</td><td><code>opus_int16*</code>: 输入信号 (交叉存取如果是 2 通道). 长度为 frame_size*channels*sizeof(opus_int16) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">frame_size</td><td><code>int</code>: 输入信号每个通道的采样数。该值必须是对应解码器采样率的一个Opus帧大小。例如，当采样率 48 kHz 时，允许值有 120, 240, 480, 960, 1920, 2880。传递一个持续时间少于10 ms(480样本，48 kHz)将阻止编码器使用LPC或混合模式。</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">data</td><td><code>unsigned char*</code>: 输出负载，必须包含最少 <em>max_data_bytes</em> 的存储空间。</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">max_data_bytes</td><td><code>opus_int32</code>: 输出负载分配内存空间大小。该值可能用于设置即时比特率的上限，但不应作为唯一的比特率控制。可使用 <a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoderctls.html#ga0bb51947e355b33d0cb358463b5101a7" title="Configures the bitrate in the encoder.">OPUS_SET_BITRATE</a> 来控制比特率。</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>返回：</dt><dd>成功返回编码后数据包长度(以比特为单位)，失败返回一个负数的错误码 (参见 <a class="el" href="group__opus__errorcodes.html">错误码</a>)。</dd></dl>

</div>
</div>
<a class="anchor" id="ga4ae9905859cd241ef4bb5c59cd5e5309"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/opus__types_8h.html#aa4d309d6f80b99dbabebc8f98879ab9a">opus_int32</a> opus_encode_float </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaf461a3ef2f10c2fe8b994a176f06c9bd">OpusEncoder</a> *&#160;</td>
          <td class="paramname"><em>st</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const float *&#160;</td>
          <td class="paramname"><em>pcm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>frame_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/opus__types_8h.html#aa4d309d6f80b99dbabebc8f98879ab9a">opus_int32</a>&#160;</td>
          <td class="paramname"><em>max_data_bytes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>通过浮点输入编码 Opus 帧。</p>
<dl class="params"><dt>参数：</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">st</td><td><code>OpusEncoder*</code>: 编码状态 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pcm</td><td><code>float*</code>: 浮点格式输入(交叉存取如果是 2 通道)，正常范围 +/-1.0。样本范围超过 +/-1.0 也是支持的，但是其值会被解码器使用整型API截取掉并且仅可以在知道远端支持扩展动态范围的情况下使用。长度为 frame_size*channels*sizeof(float) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">frame_size</td><td><code>int</code>: 输入信号每个通道的采样数。该值必须是对应解码器采样率的一个Opus帧大小。例如，当采样率 48 kHz 时，允许值有 120, 240, 480, 960, 1920, 2880。传递一个持续时间少于10 ms(480样本，48 kHz)将阻止编码器使用LPC或混合模式。</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">data</td><td><code>unsigned char*</code>: 输出负载，必须包含最少 <em>max_data_bytes</em>的存储空间。 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">max_data_bytes</td><td><code>opus_int32</code>: 输出负载分配内存空间大小。该值可能用于设置即时比特率的上限，但不应作为唯一的比特率控制。可使用 <a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoderctls.html#ga0bb51947e355b33d0cb358463b5101a7" title="Configures the bitrate in the encoder.">OPUS_SET_BITRATE</a> 来控制比特率。</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>返回：</dt><dd>成功返回编码后数据包长度(以比特为单位)，失败返回一个负数的错误码 (参见 <a class="el" href="group__opus__errorcodes.html">错误码</a>)。</dd></dl>

</div>
</div>
<a class="anchor" id="gaa89264fd93c9da70362a0c9b96b9ca88"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaf461a3ef2f10c2fe8b994a176f06c9bd">OpusEncoder</a>* opus_encoder_create </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/opus__types_8h.html#aa4d309d6f80b99dbabebc8f98879ab9a">opus_int32</a>&#160;</td>
          <td class="paramname"><em>Fs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>channels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>application</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>分配并初始化编码模式。</p>
<p>此处由三种编码模式</p>
<p><a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__ctlvalues.html#ga07884aa018303a419d1f7acb2f3fa669">OPUS_APPLICATION_VOIP</a> 在给定比特率下有很高的质量，常用于语音信号。通过使用高通滤波器提高输入信号并且加强共振峰和谐波。另外，可以使用带内前向纠错保护来防止丢包。这种模式正是典型的VoIP应用所使用的。由于使用增强，即时在高比特率下，其输出也可能听起来与输入有所不同。</p>
<p><a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__ctlvalues.html#ga5909f7cb35c04f1110026c6889edd345">OPUS_APPLICATION_AUDIO</a> 在给定比特率下有很高的质量，常用于非语音信号如，音乐。该模式专为音乐、混合内容(音乐/语音)广播、以及应用要求少于15ms的延迟的情况使用。</p>
<p><a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__ctlvalues.html#ga592232fb39db60c1369989c5c5d19a07">OPUS_APPLICATION_RESTRICTED_LOWDELAY</a> 配置低延迟模式,禁用语音优化模式以换取稍微降低延迟。因为这种模式会改变编解码器延迟，所以只能设置一个新初始化或已经重置的编码器。</p>
<p>此模式在当调用者知道语音优化模式不被使用时是有用的(注意小心使用)。</p>
<dl class="params"><dt>参数：</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">Fs</td><td><code>opus_int32</code>: 输入信号采样率(Hz)，必须是8000, 12000, 16000, 24000, 48000之一。</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">channels</td><td><code>int</code>: 输入信号的通道代号 (1 or 2)。</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">application</td><td><code>int</code>: 编码模式 (<a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__ctlvalues.html#ga07884aa018303a419d1f7acb2f3fa669">OPUS_APPLICATION_VOIP</a>/<a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__ctlvalues.html#ga5909f7cb35c04f1110026c6889edd345">OPUS_APPLICATION_AUDIO</a>/<a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__ctlvalues.html#ga592232fb39db60c1369989c5c5d19a07">OPUS_APPLICATION_RESTRICTED_LOWDELAY</a>) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">error</td><td><code>int*</code>: <a class="el" href="group__opus__errorcodes.html">错误码</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>注意：</dt><dd>针对所选通道采样的比率和数量，当所选比特率太低时，Opus编码器可以自动切换到一个较低的音频带宽或通道。这也意味着使用 48 kHz 立体声输入让编码器自动优化编码是安全的。</dd></dl>

</div>
</div>
<a class="anchor" id="ga164cbb0425238961919adf1db67949df"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int opus_encoder_ctl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaf461a3ef2f10c2fe8b994a176f06c9bd">OpusEncoder</a> *&#160;</td>
          <td class="paramname"><em>st</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>使用用 CTL 执行 Opus 编码。</p>
<p>通常 request 和之后的参数由一个常用宏赋值。</p>
<dl class="params"><dt>参数：</dt><dd>
  <table class="params">
    <tr><td class="paramname">st</td><td><code>OpusEncoder*</code>: 编码状态。 </td></tr>
    <tr><td class="paramname">request</td><td>这里的所有参数都应该使用在 <a class="el" href="group__opus__genericctls.html">通用 CTLs</a> 或者 <a class="el" href="group__opus__encoderctls.html">Encoder related CTLs</a>  中定义的常用宏。</td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>另请参见：</dt><dd><a class="el" href="group__opus__genericctls.html" title="These macros are used with the opus_decoder_ctl and opus_encoder_ctl calls to generate a particular r...">通用 CTLs</a> </dd>
<dd>
<a class="el" href="group__opus__encoderctls.html" title="These are convenience macros for use with the opus_encode_ctl interface.">Encoder related CTLs</a> </dd></dl>

</div>
</div>
<a class="anchor" id="ga5f4c05b4b51cdffec5a55dbf17bbfa1c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void opus_encoder_destroy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaf461a3ef2f10c2fe8b994a176f06c9bd">OpusEncoder</a> *&#160;</td>
          <td class="paramname"><em>st</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>释放由 <a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaa89264fd93c9da70362a0c9b96b9ca88" title="Allocates and initializes an encoder state.">opus_encoder_create()</a> 分配的 <code>OpusEncoder</code>。</p>
<dl class="params"><dt>参数：</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">st</td><td><code>OpusEncoder*</code>: 需要被释放的编码状态 </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="gaefeb7dc1d6e3b59dea5ea674c86e9c18"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int opus_encoder_get_size </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>channels</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>得到 <code>OpusEncoder</code> 结构体的大小. </p>
<dl class="params"><dt>参数：</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">channels</td><td><code>int</code>: 通道代号，必须为1或2。 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>返回：</dt><dd>大小，以比特为单位。</dd></dl>

</div>
</div>
<a class="anchor" id="ga515db1c267a7421dacaad3610f79eb79"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int opus_encoder_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaf461a3ef2f10c2fe8b994a176f06c9bd">OpusEncoder</a> *&#160;</td>
          <td class="paramname"><em>st</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/opus__types_8h.html#aa4d309d6f80b99dbabebc8f98879ab9a">opus_int32</a>&#160;</td>
          <td class="paramname"><em>Fs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>channels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>application</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>初始化一个预分配的编码状态，该内存由 st 指向一块大小最小为 <a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaefeb7dc1d6e3b59dea5ea674c86e9c18" title="Gets the size of an OpusEncoder structure.">opus_encoder_get_size()</a> 返回值的内存空间。 </p>
<p>该函数用于应用使用它们特有的分配器代替存储器分配(malloc). </p>
<dl class="section see"><dt>另请参见：</dt><dd><a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaa89264fd93c9da70362a0c9b96b9ca88" title="Allocates and initializes an encoder state.">opus_encoder_create()</a>,<a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__encoder.html#gaefeb7dc1d6e3b59dea5ea674c86e9c18" title="Gets the size of an OpusEncoder structure.">opus_encoder_get_size()</a> 来冲定义预初始化状态，使用 <a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__genericctls.html#gadc74e4fa8bcdf9994187d52d92207337" title="Resets the codec state to be equivalent to a freshly initialized state.">OPUS_RESET_STATE</a> CTL。</dd></dl>
<dl class="params"><dt>参数：</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">st</td><td><code>OpusEncoder*</code>: 编码状态 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Fs</td><td><code>opus_int32</code>: 输入信号采样率(Hz)，必须是8000, 12000, 16000, 24000, 48000之一。 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">channels</td><td><code>int</code>: 输入信号的通道代号 (1 or 2) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">application</td><td><code>int</code>: 编码模式 (OPUS_APPLICATION_VOIP/OPUS_APPLICATION_AUDIO/OPUS_APPLICATION_RESTRICTED_LOWDELAY) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>返回：</dt><dd>
  <table class="retval">
    <tr><td class="paramname"><a class="el" href="http://www.opus-codec.org/docs/html_api-1.1.0/group__opus__errorcodes.html#gaa44cf8a185e1b5cb940ef63eb4f02d21" title="No error.">OPUS_OK</a></td><td>成功或者 <a class="el" href="group__opus__errorcodes.html">错误码</a> </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->

<hr class="footer"/>
<table width="100%"><tbody><tr><td>
更多信息查看<a href="http://opus-codec.org/"> Opus 站点 </a>.
</td><td><address class="footer"><small>
&copy;2013<br/>
Generated on Wed Dec 4 2013 15:16:40 for Opus by <a href="http://www.doxygen.org/index.html">
<!--<img class="footer" src="doxygen.png" alt="doxygen"/>-->doxygen
</a> 1.8.3.1
</small></address></tr></tbody></table>
</body>
</html>
